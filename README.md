# ひらがな手書き練習アプリ (Hiragana Writing Practice App)

子供向けのひらがな手書き練習アプリケーションです。4歳児を対象とした、直感的で楽しい学習体験を提供します。

## 🌟 特徴

### 🎯 拡張された練習体験システム
- **寛容な認識システム**: 4歳児の描画特性に最適化された認識アルゴリズム
- **励まし重視の採点**: 努力を評価し、常に前向きなフィードバックを提供
- **画数・複雑さベース難易度**: より教育的な3段階分類（初級・中級・上級）
- **子供向け正規化処理**: 震え、不完全な線、サイズのばらつきを自動補正

### 📚 学習機能
- **全ひらがな対応**: 46文字すべてのひらがなに対応（あ〜ん）
- **インテリジェントランダム出題**: 習熟度と練習頻度を考慮した最適な文字選択
- **段階的難易度システム**: 画数と複雑さに基づく教育的な進行
- **詳細進捗追跡**: 文字別の練習履歴、習熟度、成長パターンの可視化

### 🎨 子供向けデザイン
- **タッチフレンドリー**: タブレットやスマートフォンでの手書き入力に最適化
- **直感的UI**: 大きなボタン、カラフルなデザイン、分かりやすいアイコン
- **励ましのメッセージ**: 失敗を恐れない、常に前向きなフィードバック
- **手本表示**: 正しい文字形を参考として表示

### 🔧 技術的特徴
- **高性能認識エンジン**: リアルタイム描画認識とフィードバック
- **データ永続化**: 練習進捗の自動保存と復元
- **エラーハンドリング**: 堅牢なフォールバック機能
- **メモリ最適化**: 大量データの効率的な処理

## 📱 対応文字

全46文字のひらがなに対応しています：

### あ行（難易度1）
あ、い、う、え、お

### か行（難易度2）
か、き、く、け、こ

### さ行（難易度2）
さ、し、す、せ、そ

### た行（難易度2）
た、ち、つ、て、と

### な行（難易度2）
な、に、ぬ、ね、の

### は行（難易度3）
は、ひ、ふ、へ、ほ

### ま行（難易度3）
ま、み、む、め、も

### や行（難易度3）
や、ゆ、よ

### ら行（難易度4）
ら、り、る、れ、ろ

### わ行（難易度4）
わ、を、ん

## 🚀 使い方

### 開発環境での起動

1. **リポジトリをクローン**
   ```bash
   git clone <repository-url>
   cd hiragana-writing-practice
   ```

2. **依存関係をインストール**
   ```bash
   npm install
   ```

3. **ローカルサーバーで起動**
   
   任意の静的ファイルサーバーを使用してください：
   
   ```bash
   # Python 3の場合
   python -m http.server 8000
   
   # Node.jsのhttp-serverを使用する場合
   npx http-server
   
   # Live Serverを使用する場合
   npx live-server
   ```

4. **ブラウザでアクセス**
   
   `http://localhost:8000` にアクセスしてアプリを開始

### アプリの使用方法

1. **練習モード選択**: 
   - 「ランダム練習」: 全文字からランダムに出題
   - 「難易度別練習」: 指定した難易度の文字のみ練習
2. **文字を書く**: 表示された文字をキャンバスに指やペンで書く
3. **手本確認**: 「手本を見る」ボタンで正しい文字形を確認
4. **提出**: 「できた！」ボタンで採点を受ける
5. **結果確認**: フィードバックを確認し、次の文字に進むか再挑戦
6. **進捗確認**: 練習した文字の履歴と習熟度を確認

## 🛠️ 技術スタック

### フロントエンド
- **Vanilla JavaScript (ES6 modules)** - フレームワークなし、純粋なJSとモダンなモジュールシステム
- **HTML5 Canvas** - 描画インターフェースとストローク取得
- **CSS3** - グラデーション、flexbox、レスポンシブデザインを使用したカスタムスタイリング
- **Web APIs** - タッチイベント、localStorage によるデータ永続化

### ビルドシステム & テスト
- **Jest** - jsdom環境でのテストフレームワーク
- **Babel** - テスト用のES6+トランスパイル
- **ES Modules** - ネイティブブラウザモジュールシステム

### アーキテクチャパターン
- **コンポーネントベースアーキテクチャ** - 画面/機能ごとの分離されたコンポーネント
- **サービス層** - サービスクラスに分離されたビジネスロジック
- **モデルクラス** - セッション、文字、描画データのデータ構造
- **イベント駆動** - DOMイベントとカスタムイベントハンドリング

## 📁 プロジェクト構造

```
hiragana-writing-practice/
├── index.html                 # メインアプリケーションエントリーポイント
├── package.json              # 依存関係とスクリプト
├── jest.config.js            # テスト設定
├── js/
│   ├── main.js               # アプリケーションブートストラップ
│   ├── app.js                # メインAppクラス、中央コーディネーター
│   ├── components/           # UIコンポーネント
│   │   ├── MainMenuComponent.js
│   │   ├── PracticeViewComponent.js
│   │   ├── ExampleViewComponent.js
│   │   ├── ResultViewComponent.js
│   │   ├── CharacterDisplayComponent.js
│   │   └── ProgressViewComponent.js
│   ├── services/             # ビジネスロジック
│   │   ├── DrawingService.js          # 描画とストローク取得
│   │   ├── RecognitionService.js      # 寛容な文字認識システム
│   │   ├── ScoreService.js            # 励まし重視の採点システム
│   │   ├── HiraganaDataService.js     # 文字データと難易度管理
│   │   ├── DataStorageService.js      # データ永続化
│   │   ├── RandomizationService.js    # インテリジェント文字選択
│   │   ├── ProgressTrackingService.js # 進捗追跡と分析
│   │   ├── DataMigrationService.js    # データ移行とバージョン管理
│   │   ├── DataValidationService.js   # データ整合性検証
│   │   ├── PerformanceMonitor.js      # パフォーマンス監視
│   │   └── ErrorHandler.js            # エラーハンドリングとフォールバック
│   └── models/               # データモデル
│       ├── PracticeSession.js
│       ├── DrawingData.js
│       ├── HiraganaCharacter.js
│       └── CharacterProgress.js
├── styles/
│   └── main.css              # 全アプリケーションスタイル
├── tests/                    # テストスイート
│   ├── setup.js              # Jestテスト環境セットアップ
│   └── *.test.js             # コンポーネントとサービスのユニットテスト
└── test-*.html               # 手動テスト用ページ
```

## 🎯 学習機能

### ランダム出題システム
アプリは以下のアルゴリズムで効果的な学習を支援します：

- **重み付き選択**: 練習頻度の低い文字ほど出題されやすくなります
- **反復防止**: 同じ文字が連続で出題されることを防ぎます
- **進捗連動**: 習熟度の低い文字を優先的に出題します
- **バランス調整**: 全文字を均等に練習できるよう自動調整します

### 拡張された難易度システム
文字は画数と複雑さに基づいて3段階に分類されています：

#### 初級（Beginner）- 画数が少なく、シンプルな形状
- **1-2画**: く、そ、つ、て、の、ひ、へ、し、る、れ、ん
- **特徴**: 直線的、曲線が少ない、書きやすい

#### 中級（Intermediate）- 中程度の画数と複雑さ
- **2-3画**: あ、い、う、え、お、か、こ、さ、す、せ、ち、と、に、ぬ、ね、ま、み、め、や、よ、ゆ、ら、り、ろ、わ
- **特徴**: 適度な曲線、バランスが重要

#### 上級（Advanced）- 画数が多く、複雑な形状
- **3-4画以上**: き、け、た、な、は、ふ、ほ、む、も、を
- **特徴**: 複雑な曲線、複数のストローク、高い精度が必要

### 進捗追跡
各文字の学習状況を詳細に記録：

- **練習回数**: 各文字の練習回数を記録
- **平均スコア**: 文字別の平均得点を計算
- **習熟度**: 練習頻度とスコアから習熟レベルを判定
- **最終練習日**: 最後に練習した日時を記録

## 🧪 テスト

### テスト実行

```bash
# 全テストを実行
npm test

# ウォッチモードでテスト実行
npm run test:watch

# カバレッジレポート生成
npm run test:coverage
```

### テストの種類

#### 基本テスト
- **ユニットテスト**: 各コンポーネントとサービスの個別テスト
- **統合テスト**: コンポーネント間の連携テスト
- **ランダム化テスト**: 文字選択アルゴリズムの検証
- **進捗追跡テスト**: データ永続化と復元の検証

#### 拡張された練習体験システムテスト
- **統合テスト**: 寛容な認識システムと励まし重視採点システムの連携テスト
- **パフォーマンステスト**: 認識アルゴリズムのレスポンス時間とメモリ効率性テスト
- **エラーハンドリングテスト**: フォールバック機能と例外処理の検証
- **メモリ最適化テスト**: 大量データ処理時のメモリ管理とリソース最適化テスト

#### システムテスト
- **データ移行テスト**: 既存データの互換性確認
- **ブラウザ互換性テスト**: 必要なWeb API対応チェック
- **タッチ操作テスト**: タッチイベントの処理テスト
- **負荷テスト**: 高頻度認識リクエストの処理能力テスト

## 🌐 ブラウザサポート

### 必要な機能
- ES6 モジュールサポート
- HTML5 Canvas API
- Touch Events API
- localStorage API

### 推奨ブラウザ
- Chrome 61+
- Firefox 60+
- Safari 11+
- Edge 16+

### モバイル対応
- iOS Safari 11+
- Chrome for Android 61+
- Samsung Internet 7.2+

## 🎨 デザインコンセプト

### 子供向けデザイン原則
- **シンプルさ重視**: 複雑さより分かりやすさを優先
- **視覚的フィードバック**: テキストより視覚的な反応を重視
- **励まし重視**: 批判より励ましを重視
- **タッチファースト**: タッチ操作を前提とした設計
- **日本語インターフェース**: UI テキストは日本語

### カラーパレット
- **メインカラー**: #4ECDC4 (青緑) - 落ち着きと集中
- **アクセントカラー**: #FF6B6B (赤) - 注意と行動
- **成功カラー**: #FFD93D (黄) - 達成感と喜び
- **背景グラデーション**: #FFE5B4 → #FFCCCB (暖かみのある色調)

## 🧪 拡張された練習体験システムの技術詳細

### 🎯 認識アルゴリズムの特徴

#### 子供向け最適化
```javascript
// 4歳児の描画特性に対応した正規化処理
const childNormalizedStrokes = this.normalizeChildDrawing(strokes, boundingBox);
- 震え・揺れの平滑化
- 不完全な線の補完
- サイズ正規化（20x20〜300x300の範囲）
- アスペクト比の調整
```

#### 寛容な判定基準
```javascript
// 子供向けの寛容な信頼度閾値
const childFriendlyThresholds = {
    excellent: 0.6,  // 従来: 0.8
    fair: 0.25,      // 従来: 0.5
    poor: 0.0        // 描画があれば最低評価を回避
};
```

### 💝 採点システムの革新

#### 努力評価アルゴリズム
```javascript
// 描画の努力を数値化
calculateDrawingEffortScore(drawingData) {
    let effortScore = 0;
    if (strokeCount > 0) effortScore += 0.3;  // 描画を試みた基本点
    if (totalPoints > 5) effortScore += 0.2;  // 一定以上の描画努力
    if (area > 100) effortScore += 0.2;       // 適切なサイズでの描画
    return Math.min(1, effortScore);
}
```

#### 励ましメッセージシステム
```javascript
// レベル別の励ましメッセージ
const encouragingMessages = {
    excellent: ['すばらしい！', 'とても上手です！'],
    fair: ['いいかんじです！', 'だんだん上手になっています！'],
    poor: ['だいじょうぶ！', 'がんばって！']
};
```

### 📐 画数・複雑さベース難易度システム

#### 複雑さスコア計算
```javascript
// 文字の複雑さを0.0-1.0で数値化
calculateComplexity() {
    const strokeWeight = this.strokeCount * 0.4;
    const curveWeight = this.features.hasCurve ? 0.3 : 0;
    const balanceWeight = this.features.complexity * 0.3;
    return Math.min(1.0, strokeWeight + curveWeight + balanceWeight);
}
```

#### 教育的順序付け
```javascript
// 教育的に最適な学習順序を提供
getPedagogicalOrder() {
    const baseOrder = this.strokeCount * 100;
    const complexityAdjustment = this.getComplexityScore() * 50;
    return baseOrder + complexityAdjustment;
}
```

### ⚡ パフォーマンス最適化技術

#### 高速認識エンジン
- **レスポンス時間**: 単一文字認識 < 500ms
- **並列処理**: 複数文字の同時認識サポート
- **キャッシュ効率**: 同一描画の再認識を高速化

#### メモリ管理
- **効率的データ構造**: 46文字データの最適化された管理
- **ガベージコレクション**: 自動メモリクリーンアップ
- **リソース監視**: メモリ使用量の継続的監視

### 🛡️ 堅牢性とエラーハンドリング

#### 包括的フォールバック
```javascript
// あらゆる例外状況に対応
try {
    const result = await recognizeCharacter(drawing, target);
} catch (error) {
    return createEncouragingFallback(error, drawing);
}
```

#### データ整合性保証
```javascript
// 自動データ検証と修復
validateAndRepairData(data) {
    if (!this.isValidData(data)) {
        return this.repairData(data);
    }
    return data;
}
```

## 🔧 開発

### 開発用コマンド

```bash
# 依存関係インストール
npm install

# 全テスト実行（40テスト）
npm test

# 拡張された練習体験システムのテストのみ実行
npm test -- --testPathPattern="EnhancedPracticeIntegration|RecognitionPerformance|ErrorHandling|MemoryOptimization"

# テストウォッチモード
npm run test:watch

# カバレッジレポート
npm run test:coverage
```

### 拡張された練習体験システムの詳細

#### 🧠 寛容な認識システム
- **子供向け最適化**: 4歳児の描画特性（震え、不完全な線、サイズのばらつき）に対応
- **正規化処理**: 描画データの自動補正とノイズ除去
- **複雑さスコア**: 文字の画数と形状複雑さに基づく動的評価
- **信頼度調整**: 子供の能力に合わせた寛容な判定基準

#### 💝 励まし重視の採点システム
- **努力評価**: 描画の試みそのものを評価し、最低限のスコアを保証
- **前向きフィードバック**: 失敗時も建設的で励ましのメッセージを提供
- **3段階評価**: 「すばらしい」「もう少し」「がんばろう」の分かりやすい評価
- **個別対応**: 各文字の特性に応じたカスタマイズされたフィードバック

#### 📐 画数・複雑さベース難易度システム
- **教育的分類**: 従来の5段階から、より教育的な3段階（初級・中級・上級）に改良
- **画数重視**: 文字の画数を主要な難易度指標として採用
- **複雑さ考慮**: 曲線の複雑さ、バランスの難しさを副次的指標として活用
- **段階的学習**: 自然な学習進行をサポートする順序付け

#### ⚡ パフォーマンス最適化
- **高速認識**: 単一文字認識を500ms以内で完了
- **メモリ効率**: 大量データ処理時のメモリ使用量を最適化
- **キャッシュ機能**: 認識結果のキャッシュによる高速化
- **並列処理**: 複数文字の同時認識をサポート

#### 🛡️ エラーハンドリング
- **包括的フォールバック**: あらゆる例外状況に対する適切な対応
- **データ検証**: 入力データの整合性チェックと自動修復
- **グレースフルデグラデーション**: 機能低下時も基本機能を維持
- **ユーザー体験保護**: エラー時も子供が混乱しないよう配慮

### 開発ガイドライン

#### 新機能の追加
1. 適切なディレクトリ（components/services/models）にファイルを作成
2. ES6 モジュールとしてエクスポート
3. `app.js` で初期化
4. 対応するテストファイルを作成

#### 拡張されたデータ構造
- **HiraganaDataService**: 文字データと画数・複雑さベース難易度の一元管理
- **RecognitionService**: 寛容な認識アルゴリズムと子供向け正規化処理
- **ScoreService**: 励まし重視の採点システムと建設的フィードバック
- **DataValidationService**: データ整合性検証と自動修復機能
- **ProgressTrackingService**: 詳細な進捗分析と習熟度評価

#### 高度なパフォーマンス最適化
- **認識エンジン最適化**: 500ms以内の高速文字認識
- **メモリ管理**: 大量データ処理時の効率的なメモリ使用
- **キャッシュシステム**: 認識結果とスコア計算のキャッシュ化
- **並列処理**: 複数認識リクエストの同時処理
- **リソース管理**: 自動ガベージコレクションとメモリリーク防止

## 📝 ライセンス

このプロジェクトは教育目的で作成されています。

## 🤝 コントリビューション

バグ報告や機能提案は Issue でお知らせください。

## 📞 サポート

技術的な問題や質問がある場合は、Issue を作成してください。

## 📈 更新履歴

### v3.0.0 - Enhanced Practice Experience (最新)
- 🧠 **寛容な認識システム**: 4歳児の描画特性に最適化された認識アルゴリズム
- 💝 **励まし重視の採点**: 努力を評価し、常に前向きなフィードバックを提供
- 📐 **画数・複雑さベース難易度**: より教育的な3段階分類システム
- 🔧 **子供向け正規化処理**: 震え、不完全な線、サイズのばらつきを自動補正
- ⚡ **パフォーマンス最適化**: レスポンス時間とメモリ使用量の大幅改善
- 🛡️ **堅牢なエラーハンドリング**: 包括的なフォールバック機能
- 🧪 **統合テストスイート**: 40の包括的テストによる品質保証
- 📊 **データ整合性検証**: 自動データ検証とマイグレーション機能

### v2.0.0 - Hiragana Expansion
- ✨ **全46文字対応**: すべてのひらがな文字に対応
- 🎲 **ランダム出題**: インテリジェントな文字選択システム
- 📊 **進捗追跡**: 文字別の詳細な学習履歴
- 🎯 **難易度システム**: 5段階の難易度分類
- 🔄 **データ移行**: 既存データの自動移行対応
- ⚡ **パフォーマンス最適化**: 大量文字データの効率的処理
- 🧪 **テスト拡充**: 包括的なテストカバレッジ

### v1.0.0 - Initial Release
- 📝 基本的なひらがな練習機能（15文字）
- 🎨 子供向けUI/UX
- ✏️ タッチ描画機能
- 📱 レスポンシブデザイン

---

**楽しいひらがな学習を！** ✨📝🎌